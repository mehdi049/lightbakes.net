@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="center-content container-fluid">
    <div class="row">
        <div class="text-center col">
            <h1 class="border-orange inline-block">Mon panier</h1><br>
        </div>
    </div>
</div>

<div class="container">
    <div class="row hide" id="empty-basket-msg">
        <div class="col">
            <div role="alert" class="fade alert alert-info show">Le panier est vide.</div>
        </div>
    </div>
    <div class="row hide" id="basket-list">
        <div class="col">
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="text-bold">Produit</th>
                            <th class="text-bold">Quantité</th>
                            <th class="text-bold">Prix</th>
                            <th class="text-bold" style="width: 100px;"></th>
                        </tr>
                    </thead>
                    <tbody id="basket-body">
                    </tbody>
                </table>
            </div>
            <p class="text-italic">
                <i class="fas fa-truck"></i>&nbsp; <b>Paiement à la livraison.</b>
                <br><br>
                <b>Note:</b> Le panier sera réinitialisé aprés le passage de la commande.
            </p>
            <div class="text-right">
                <button type="button" class="btn btn-outline-primary">Passer la commande</button>
            </div>
        </div>
    </div>
</div>

<br />
@section Scripts {
    <!-- basket.js -->
    <script>
        $(function () {
            $("#header").addClass("header-black-bg");

            function redrawTable() {
                var basketItem = localStorage.getItem("basket") !== null
                    ? JSON.parse(localStorage.getItem("basket"))
                    : [];

                if (basketItem.length > 0) {
                    $("#empty-basket-msg").hide();
                    $("#basket-list").show();
                }
                else {
                    $("#empty-basket-msg").show();
                    $("#basket-list").hide();
                }

                var basketTable = "";
                var totalAmount = 0;
                for (var i = 0; i < basketItem.length; i++) {
                    basketTable += "<tr>";
                    basketTable += "<td><a href='/product/" + basketItem[i].ProductId + "'>" + basketItem[i].Product + " " + basketItem[i].Option + " (" + basketItem[i].Unity + ")</a></td>";
                    basketTable += "<td>" + basketItem[i].Quantity + "</td>";
                    basketTable += "<td>" + basketItem[i].TotalPrice + " TND</td>";
                    basketTable += "<td><i class='fas fa-trash-alt pointer' data-id='" + basketItem[i].Id + "'></i></td>";
                    basketTable += "</tr>";
                    totalAmount += parseFloat("" + basketItem[i].TotalPrice.replace(/,/gi, "."));
                }
                basketTable += "<tr>";
                basketTable += "<td colspan='2' class='text-right text-bold'>Total</td>";
                basketTable += "<td class='text-bold'>" + totalAmount + " TND</td>";
                basketTable += "</tr>";

                $("#basket-body").html(basketTable);

                $(".fa-trash-alt").click(function () {
                    var id = $(this).attr("data-id");
                    removeBasketItem(id);
                });
            }

            redrawTable();


            function removeBasketItem(id) {
                var basketItem = JSON.parse(localStorage.getItem("basket"));
                var itemsAfterRemove = basketItem.filter((x) => x.Id !== id);
                localStorage.setItem("basket", JSON.stringify(itemsAfterRemove));

                redrawTable();
                $.toast({
                    text: 'Produit retiré avec succés.',
                    showHideTransition: 'plain',
                    hideAfter: 5000,
                    icon: 'success',
                    position: 'top-right'
                });
            }

        });
    </script>
}